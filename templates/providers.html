<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Providers - Email Platform</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M3 8L10.89 13.26C11.2187 13.4793 11.6049 13.5963 12 13.5963C12.3951 13.5963 12.7813 13.4793 13.11 13.26L21 8M5 19H19C19.5304 19 20.0391 18.7893 20.4142 18.4142C20.7893 18.0391 21 17.5304 21 17V7C21 6.46957 20.7893 5.96086 20.4142 5.58579C20.0391 5.21071 19.5304 5 19 5H5C4.46957 5 3.96086 5.21071 3.58579 5.58579C3.21071 5.96086 3 6.46957 3 7V17C3 17.5304 3.21071 18.0391 3.58579 18.4142C3.96086 18.7893 4.46957 19 5 19Z"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                Email Platform
            </div>
            <ul class="nav-links">
                <li><a href="/">Dashboard</a></li>
                <li><a href="/providers" class="active">Providers</a></li>
                <li><a href="/templates">Templates</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <div style="margin-bottom: 2rem;">
            <h1
                style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem; background: var(--gradient-1); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                Email Providers
            </h1>
            <p style="color: var(--text-muted); font-size: 1.125rem;">
                Configure your SMTP and API email providers
            </p>
        </div>

        <!-- Providers Card -->
        <div class="card fade-in-up">
            <div class="card-header">
                <h2>ðŸ”Œ Configured Providers</h2>
                <div class="card-actions">
                    <button class="btn btn-primary" onclick="showModal('newProviderModal')">
                        <span>+</span> Add Provider
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Provider Name</th>
                            <th>Type</th>
                            <th>From Email</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="providersTable">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 3rem;">
                                <div class="loading"></div>
                                <p style="margin-top: 1rem; color: var(--text-muted);">Loading providers...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Info Cards -->
        <div
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 2rem;">
            <div class="card" style="margin-bottom: 0;">
                <h3 style="margin-bottom: 1rem; color: var(--primary);">ðŸ“§ SMTP Providers</h3>
                <p style="color: var(--text-muted); margin-bottom: 1rem;">
                    Connect to any SMTP server like Gmail, Outlook, or your own mail server.
                </p>
                <ul style="color: var(--text-muted); padding-left: 1.5rem;">
                    <li>Standard SMTP protocol</li>
                    <li>TLS/SSL support</li>
                    <li>Configurable rate limits</li>
                </ul>
            </div>

            <div class="card" style="margin-bottom: 0;">
                <h3 style="margin-bottom: 1rem; color: var(--secondary);">ðŸš€ API Providers</h3>
                <p style="color: var(--text-muted); margin-bottom: 1rem;">
                    Use modern email APIs for better deliverability and analytics.
                </p>
                <ul style="color: var(--text-muted); padding-left: 1.5rem;">
                    <li>SendGrid, Mailgun, Postmark</li>
                    <li>Amazon SES, Mailjet</li>
                    <li>Higher throughput</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- New Provider Modal (simplified - just shows message for now) -->
    <div class="modal-overlay" id="newProviderModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Add Email Provider</h3>
                <button class="modal-close" onclick="hideModal('newProviderModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-muted); margin-bottom: 1.5rem;">
                    Use API endpoints to add providers programmatically:
                </p>

                <div
                    style="background: var(--dark-lighter); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                    <strong>SMTP Provider:</strong>
                    <pre
                        style="margin: 0.5rem 0 0 0; font-size: 0.875rem; color: var(--primary);">POST /api/smtp-accounts</pre>
                </div>

                <div style="background: var(--dark-lighter); padding: 1rem; border-radius: 0.5rem;">
                    <strong>API Provider:</strong>
                    <pre
                        style="margin: 0.5rem 0 0 0; font-size: 0.875rem; color: var(--primary);">POST /api/api-providers</pre>
                </div>

                <p style="color: var(--text-muted); margin-top: 1.5rem; font-size: 0.875rem;">
                    For detailed examples, check the documentation or use the API test endpoint.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('newProviderModal')">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        async function loadProviders() {
            const tbody = document.getElementById('providersTable');

            try {
                const [smtp, api] = await Promise.all([
                    fetch(`${API_BASE}/smtp-accounts`).then(r => r.json()),
                    fetch(`${API_BASE}/api-providers`).then(r => r.json())
                ]);

                const providers = [
                    ...smtp.map(p => ({ ...p, type: 'SMTP' })),
                    ...api.map(p => ({ ...p, type: p.provider_type.toUpperCase() }))
                ];

                if (providers.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 3rem;">
                                <div class="empty-state">
                                    <div class="empty-state-icon">ðŸ”Œ</div>
                                    <h3>No providers configured</h3>
                                    <p>Add an email provider to start sending campaigns</p>
                                    <button class="btn btn-primary" onclick="showModal('newProviderModal')">
                                        <span>+</span> Add Provider
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = providers.map(provider => `
                    <tr>
                        <td><strong>${provider.name}</strong></td>
                        <td><span class="badge badge-info">${provider.type}</span></td>
                        <td>${provider.from_email}</td>
                        <td>
                            <span class="badge badge-${provider.enabled ? 'success' : 'danger'}">
                                ${provider.enabled ? 'Active' : 'Disabled'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="deleteProvider('${provider.type}', ${provider.id})">
                                Delete
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading providers:', error);
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: var(--danger);">Error loading providers</td></tr>';
            }
        }

        async function deleteProvider(type, id) {
            if (!confirm('Are you sure you want to delete this provider?')) {
                return;
            }

            try {
                const endpoint = type === 'SMTP' ? '/smtp-accounts' : '/api-providers';
                await fetch(`${API_BASE}${endpoint}/${id}`, { method: 'DELETE' });
                loadProviders();
            } catch (error) {
                console.error('Error deleting provider:', error);
                alert('Failed to delete provider');
            }
        }

        // Load on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadProviders();

            // Refresh every 30 seconds
            setInterval(loadProviders, 30000);
        });
    </script>
</body>

</html>